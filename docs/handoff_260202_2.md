# Handoff 2026â€‘02â€‘02 â€” RÂ² vs Window Size Plot (Piecewise Fits)

## Context
This handoff documents a **lockedâ€‘in interpretation and plotting strategy** for the RÂ² vs windowâ€‘duration diagnostics in the `envelope-decay-fit` subâ€‘project.

The underlying scoring logic is **piecewise by design** (`n = 2` by default). The current plot artifacts are not algorithmic errors but **visual misrepresentation caused by stitching multiple window sweeps into a single polyline**.

This document defines how the plot *must* be structured going forward so that it faithfully reflects the computation.

---

## Observed Issue (Root Cause)

- Multiple window sweeps / pieces are concatenated into a single `(x, y)` series.
- Window duration Î”t therefore becomes **nonâ€‘monotonic** within the plotted series.
- Matplotlib draws straight lines between the end of one sweep and the beginning of the next.

Result:
- Large diagonal artifacts
- Misleading visual slope
- False impression of global continuity

Diagnostics already confirmed this:
- `dx_min < 0`
- `dx_non_positive_count > 0`

This behavior is **expected** given piecewise scoring and is not a bug in the fitting logic.

---

## Lockedâ€‘In Decision

### âœ… One RÂ² curve per piece

Each piecewise function **must have its own RÂ² trace** in the plot.

> A piecewise algorithm must produce a piecewise visualization.

There must **not** be a single polyline representing multiple pieces.

---

## Required Plot Structure

For `n` pieces (default `n = 2`):

- Plot **one RÂ² vs Î”t curve per piece**
- All curves share the same axes
- No concatenation of x/y data across pieces

### Legend

Use explicit labels:
- `LOG fit RÂ² â€” piece 0`
- `LOG fit RÂ² â€” piece 1`
- â€¦

This makes it immediately clear:
- which piece stabilizes early
- which piece degrades late
- which piece drives breakpoint decisions

---

## Breakpoints

Breakpoint markers (vertical dashed lines) remain valid and unchanged:

- `Breakpoint 0`
- `Breakpoint 1`

They should intersect **all piecewise curves**, allowing visual inspection of:
- which piece dominates at the breakpoint
- whether the breakpoint lands in a stable RÂ² region

---

## Explicitly Forbidden Pattern

ðŸš« Do **not**:
- concatenate multiple sweeps into one `(x, y)` polyline
- rely on NaN insertion *as a substitute* for proper piece separation

NaNs are acceptable only as a temporary debugging aid, **not** as the final design.

---

## Optional (Strongly Recommended) Enhancements

These are not required for correctness but align with the diagnostic philosophy of the project:

### 1. Plotâ€‘level diagnostic annotation

If any series exhibits nonâ€‘monotonic Î”t internally, annotate:

> âš  Nonâ€‘monotonic window sweep detected â€” piecewise traces separated

### 2. Visual emphasis

- Use consistent color per piece
- Optionally fade nonâ€‘selected pieces
- Optionally bold the piece selected for final Î¶ estimation

---

## Summary (Oneâ€‘Line)

**Because the scoring is piecewise, the RÂ² visualization must also be piecewise; each function segment gets its own RÂ² curve, and a single global polyline is no longer allowed.**

---

## Status

- Interpretation: **locked**
- Plot strategy: **locked**
- Ready for implementation in OpenCode

